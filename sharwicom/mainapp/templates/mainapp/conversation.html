{% extends "mainapp/home-base.html" %}

{% load static %}

{% block body %}

<script src="{% static 'mainapp/js/conversation-sync.js' %}"></script>
<div class="conversations-wrapper">
    <div class="available-conversations">
    {% for conv in convs %}
        <div class="available-conversation">
        <!-- List of all available conversations, it displays the usernames of the people with which the requesting user is conversating -->
        <!-- Usernames link to the conversation page assosiated with that username (except the one that is currently opened) -->
        {% if conv.person1 == request.user %}
            {% if conv.person2.username == recipient_name %}
                {{ conv.person2.username }}
            {% else %}
                <a href="{% url 'conversation' conv.person2.username %}">{{ conv.person2.username }}</a>
            {% endif %}
        {% else %}
            {% if conv.person1.username == recipient_name %}
                {{ conv.person1.username }}
            {% else %}
                <a href="{% url 'conversation' conv.person1.username %}">{{ conv.person1.username }}</a>
            {% endif %}
        {% endif %}
        </div>
    {% endfor %}
    </div>
    <div class="active-conversation">
        <div class="conversation" data-user="{{ request.user.username }}" data-reciepent="{{ recipient_name }}">
            {% if success %}
                {% for msg in messages %}

                    {% if msg.author == request.user %}
                        <div class="you"><span><b>({{ msg.date }}) You:</b> {{ msg.content }}</span></div>
                    {% else %}
                        <div class="recipient"><span><b>({{ msg.date }}) {{ recipient_name }}:</b> {{ msg.content }}</span></div>
                    {% endif %}
                {% endfor %}
            {% else %}
                {{ message }}
            {% endif %}
        </div>
        <form class="create" method="post">
            {% csrf_token %}

            <input name="message-content" type="text">
            <input type="submit" value=">">
        </form>
    </div>
</div>

{% endblock %}